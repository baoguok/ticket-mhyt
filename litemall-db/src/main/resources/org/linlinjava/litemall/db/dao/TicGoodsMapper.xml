<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.linlinjava.litemall.db.dao.TicGoodsMapper">
    <resultMap id="BaseResultMap" type="org.linlinjava.litemall.db.domain.TicGoods">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <id column="goo_id" jdbcType="INTEGER" property="gooId"/>
        <result column="goo_name" jdbcType="VARCHAR" property="gooName"/>
        <result column="goo_cat_id" jdbcType="INTEGER" property="gooCatId"/>
        <result column="goo_desc" jdbcType="VARCHAR" property="gooDesc"/>
        <result column="goo_brief" jdbcType="VARCHAR" property="gooBrief"/>
        <result column="goo_is_on_sale" jdbcType="BIT" property="gooIsOnSale"/>
        <result column="goo_self_help" jdbcType="INTEGER" property="gooSelfHelp"/>
        <result column="goo_sort_order" jdbcType="SMALLINT" property="gooSortOrder"/>
        <result column="goo_total" jdbcType="INTEGER" property="gooTotal"/>
        <result column="goo_num_limit" jdbcType="INTEGER" property="gooNumLimit"/>
        <result column="goo_counter_price" jdbcType="DECIMAL" property="gooCounterPrice"/>
        <result column="goo_retail_price" jdbcType="DECIMAL" property="gooRetailPrice"/>
        <result column="goo_add_time" jdbcType="TIMESTAMP" property="gooAddTime"/>
        <result column="goo_update_time" jdbcType="TIMESTAMP" property="gooUpdateTime"/>
        <result column="goo_deleted" jdbcType="BIT" property="gooDeleted"/>
    </resultMap>
    <resultMap id="ResultMapWithCate"
               type="org.linlinjava.litemall.db.response.TicGoodResponse" extends="BaseResultMap">
        <result column="cat_name" property="catName" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and
                                    #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem"
                                             open="(" close=")" separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria"
                     separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and
                                    #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem"
                                             open="(" close=")" separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        goo_id, goo_name, goo_cat_id, goo_desc, goo_brief, goo_is_on_sale, goo_self_help,
        goo_sort_order, goo_total, goo_num_limit, goo_counter_price, goo_retail_price, goo_add_time,
        goo_update_time, goo_deleted
    </sql>
    <select id="selectByExample" parameterType="org.linlinjava.litemall.db.domain.TicGoodsExample"
            resultMap="BaseResultMap">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from tic_goods
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap"
            parameterType="java.lang.Integer">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select
        <include refid="Base_Column_List"/>
        from tic_goods
        where goo_id = #{gooId,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        delete from tic_goods
        where goo_id = #{gooId,jdbcType=INTEGER}
    </delete>
    <delete id="deleteByExample" parameterType="org.linlinjava.litemall.db.domain.TicGoodsExample">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        delete from tic_goods
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="org.linlinjava.litemall.db.domain.TicGoods">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <selectKey resultType="java.lang.Integer" keyProperty="gooId"
                   order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into tic_goods (goo_name, goo_cat_id, goo_desc,
        goo_brief, goo_is_on_sale, goo_self_help,
        goo_sort_order, goo_total, goo_num_limit,
        goo_counter_price, goo_retail_price, goo_add_time,
        goo_update_time, goo_deleted)
        )
        values (#{gooName,jdbcType=VARCHAR}, #{gooCatId,jdbcType=INTEGER}, #{gooDesc,jdbcType=VARCHAR},
        #{gooBrief,jdbcType=VARCHAR}, #{gooIsOnSale,jdbcType=BIT}, #{gooSelfHelp,jdbcType=INTEGER},
        #{gooSortOrder,jdbcType=SMALLINT}, #{gooTotal,jdbcType=INTEGER}, #{gooNumLimit,jdbcType=INTEGER},
        #{gooCounterPrice,jdbcType=DECIMAL}, #{gooRetailPrice,jdbcType=DECIMAL}, #{gooAddTime,jdbcType=TIMESTAMP},
        #{gooUpdateTime,jdbcType=TIMESTAMP}, #{gooDeleted,jdbcType=BIT})
    </insert>
    <insert id="insertSelective" parameterType="org.linlinjava.litemall.db.domain.TicGoods">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <selectKey resultType="java.lang.Integer" keyProperty="gooId"
                   order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into tic_goods
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="gooName != null">
                goo_name,
            </if>
            <if test="gooCatId != null">
                goo_cat_id,
            </if>
            <if test="gooDesc != null">
                goo_desc,
            </if>
            <if test="gooBrief != null">
                goo_brief,
            </if>
            <if test="gooIsOnSale != null">
                goo_is_on_sale,
            </if>
            <if test="gooSelfHelp != null">
                goo_self_help,
            </if>
            <if test="gooSortOrder != null">
                goo_sort_order,
            </if>
            <if test="gooTotal != null">
                goo_total,
            </if>
            <if test="gooNumLimit != null">
                goo_num_limit,
            </if>
            <if test="gooCounterPrice != null">
                goo_counter_price,
            </if>
            <if test="gooRetailPrice != null">
                goo_retail_price,
            </if>
            <if test="gooAddTime != null">
                goo_add_time,
            </if>
            <if test="gooUpdateTime != null">
                goo_update_time,
            </if>
            <if test="gooDeleted != null">
                goo_deleted,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="gooName != null">
                #{gooName,jdbcType=VARCHAR},
            </if>
            <if test="gooCatId != null">
                #{gooCatId,jdbcType=INTEGER},
            </if>
            <if test="gooDesc != null">
                #{gooDesc,jdbcType=VARCHAR},
            </if>
            <if test="gooBrief != null">
                #{gooBrief,jdbcType=VARCHAR},
            </if>
            <if test="gooIsOnSale != null">
                #{gooIsOnSale,jdbcType=BIT},
            </if>
            <if test="gooSelfHelp != null">
                #{gooSelfHelp,jdbcType=INTEGER},
            </if>
            <if test="gooSortOrder != null">
                #{gooSortOrder,jdbcType=SMALLINT},
            </if>
            <if test="gooTotal != null">
                #{gooTotal,jdbcType=INTEGER},
            </if>
            <if test="gooNumLimit != null">
                #{gooNumLimit,jdbcType=INTEGER},
            </if>
            <if test="gooCounterPrice != null">
                #{gooCounterPrice,jdbcType=DECIMAL},
            </if>
            <if test="gooRetailPrice != null">
                #{gooRetailPrice,jdbcType=DECIMAL},
            </if>
            <if test="gooAddTime != null">
                #{gooAddTime,jdbcType=TIMESTAMP},
            </if>
            <if test="gooUpdateTime != null">
                #{gooUpdateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="gooDeleted != null">
                #{gooDeleted,jdbcType=BIT},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="org.linlinjava.litemall.db.domain.TicGoodsExample"
            resultType="java.lang.Integer">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select count(*) from tic_goods
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update tic_goods
        <set>
            <if test="record.gooId != null">
                goo_id = #{record.gooId,jdbcType=INTEGER},
            </if>
            <if test="record.gooName != null">
                goo_name = #{record.gooName,jdbcType=VARCHAR},
            </if>
            <if test="record.gooCatId != null">
                goo_cat_id = #{record.gooCatId,jdbcType=INTEGER},
            </if>
            <if test="record.gooDesc != null">
                goo_desc = #{record.gooDesc,jdbcType=VARCHAR},
            </if>
            <if test="record.gooBrief != null">
                goo_brief = #{record.gooBrief,jdbcType=VARCHAR},
            </if>
            <if test="record.gooIsOnSale != null">
                goo_is_on_sale = #{record.gooIsOnSale,jdbcType=BIT},
            </if>
            <if test="record.gooSelfHelp != null">
                goo_self_help = #{record.gooSelfHelp,jdbcType=INTEGER},
            </if>
            <if test="record.gooSortOrder != null">
                goo_sort_order = #{record.gooSortOrder,jdbcType=SMALLINT},
            </if>
            <if test="record.gooTotal != null">
                goo_total = #{record.gooTotal,jdbcType=INTEGER},
            </if>
            <if test="record.gooNumLimit != null">
                goo_num_limit = #{record.gooNumLimit,jdbcType=INTEGER},
            </if>
            <if test="record.gooCounterPrice != null">
                goo_counter_price = #{record.gooCounterPrice,jdbcType=DECIMAL},
            </if>
            <if test="record.gooRetailPrice != null">
                goo_retail_price = #{record.gooRetailPrice,jdbcType=DECIMAL},
            </if>
            <if test="record.gooAddTime != null">
                goo_add_time = #{record.gooAddTime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.gooUpdateTime != null">
                goo_update_time = #{record.gooUpdateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.gooDeleted != null">
                goo_deleted = #{record.gooDeleted,jdbcType=BIT},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update tic_goods
        set goo_id = #{record.gooId,jdbcType=INTEGER},
        goo_name = #{record.gooName,jdbcType=VARCHAR},
        goo_cat_id = #{record.gooCatId,jdbcType=INTEGER},
        goo_desc = #{record.gooDesc,jdbcType=VARCHAR},
        goo_brief = #{record.gooBrief,jdbcType=VARCHAR},
        goo_is_on_sale = #{record.gooIsOnSale,jdbcType=BIT},
        goo_self_help = #{record.gooSelfHelp,jdbcType=INTEGER},
        goo_sort_order = #{record.gooSortOrder,jdbcType=SMALLINT},
        goo_total = #{record.gooTotal,jdbcType=INTEGER},
        goo_num_limit = #{record.gooNumLimit,jdbcType=INTEGER},
        goo_counter_price = #{record.gooCounterPrice,jdbcType=DECIMAL},
        goo_retail_price = #{record.gooRetailPrice,jdbcType=DECIMAL},
        goo_add_time = #{record.gooAddTime,jdbcType=TIMESTAMP},
        goo_update_time = #{record.gooUpdateTime,jdbcType=TIMESTAMP},
        goo_deleted = #{record.gooDeleted,jdbcType=BIT}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="org.linlinjava.litemall.db.domain.TicGoods">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update tic_goods
        <set>
            <if test="gooName != null">
                goo_name = #{gooName,jdbcType=VARCHAR},
            </if>
            <if test="gooCatId != null">
                goo_cat_id = #{gooCatId,jdbcType=INTEGER},
            </if>
            <if test="gooDesc != null">
                goo_desc = #{gooDesc,jdbcType=VARCHAR},
            </if>
            <if test="gooBrief != null">
                goo_brief = #{gooBrief,jdbcType=VARCHAR},
            </if>
            <if test="gooIsOnSale != null">
                goo_is_on_sale = #{gooIsOnSale,jdbcType=BIT},
            </if>
            <if test="gooSelfHelp != null">
                goo_self_help = #{gooSelfHelp,jdbcType=INTEGER},
            </if>
            <if test="gooSortOrder != null">
                goo_sort_order = #{gooSortOrder,jdbcType=SMALLINT},
            </if>
            <if test="gooTotal != null">
                goo_total = #{gooTotal,jdbcType=INTEGER},
            </if>
            <if test="gooNumLimit != null">
                goo_num_limit = #{gooNumLimit,jdbcType=INTEGER},
            </if>
            <if test="gooCounterPrice != null">
                goo_counter_price = #{gooCounterPrice,jdbcType=DECIMAL},
            </if>
            <if test="gooRetailPrice != null">
                goo_retail_price = #{gooRetailPrice,jdbcType=DECIMAL},
            </if>
            <if test="gooAddTime != null">
                goo_add_time = #{gooAddTime,jdbcType=TIMESTAMP},
            </if>
            <if test="gooUpdateTime != null">
                goo_update_time = #{gooUpdateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="gooDeleted != null">
                goo_deleted = #{gooDeleted,jdbcType=BIT},
            </if>
        </set>
        where goo_id = #{gooId,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="org.linlinjava.litemall.db.domain.TicGoods">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update tic_goods
        set goo_name = #{gooName,jdbcType=VARCHAR},
        goo_cat_id = #{gooCatId,jdbcType=INTEGER},
        goo_desc = #{gooDesc,jdbcType=VARCHAR},
        goo_brief = #{gooBrief,jdbcType=VARCHAR},
        goo_is_on_sale = #{gooIsOnSale,jdbcType=BIT},
        goo_self_help = #{gooSelfHelp,jdbcType=INTEGER},
        goo_sort_order = #{gooSortOrder,jdbcType=SMALLINT},
        goo_total = #{gooTotal,jdbcType=INTEGER},
        goo_num_limit = #{gooNumLimit,jdbcType=INTEGER},
        goo_counter_price = #{gooCounterPrice,jdbcType=DECIMAL},
        goo_retail_price = #{gooRetailPrice,jdbcType=DECIMAL},
        goo_add_time = #{gooAddTime,jdbcType=TIMESTAMP},
        goo_update_time = #{gooUpdateTime,jdbcType=TIMESTAMP},
        goo_deleted = #{gooDeleted,jdbcType=BIT}
        where goo_id = #{gooId,jdbcType=INTEGER}
    </update>
    <!-- 条件查询(排序)  liuyu -->
    <select id="selectGood" resultMap="ResultMapWithCate"
            parameterType="org.linlinjava.litemall.db.request.TicGoodRequest">
        SELECT goo.* ,cate.cat_name
        FROM tic_goods AS goo,
        tic_category AS cate
        WHERE goo_deleted = 0
        AND goo.goo_cat_id = cate.cat_id
        <if test="gooName !=null">
            AND goo_name like CONCAT('%',#{gooName,jdbcType=VARCHAR},'%')
        </if>
        <if test="gooCatId != null">
            AND goo_cat_id = #{gooCatId,jdbcType=INTEGER}
        </if>
        <if test="gooIsOnSale != null">
            AND goo_is_on_sale = #{gooIsOnSale,jdbcType=BIT}
        </if>
        <if test="gooSelfHelp != null">
            AND goo_self_help = #{gooSelfHelp,jdbcType=INTEGER},
        </if>
    </select>

    <!-- 库存 -->
    <resultMap id="ResultMapStock" type="org.linlinjava.litemall.db.domain.GoodsStock"
               extends="BaseResultMap">
        <result column="stock" property="stock" jdbcType="INTEGER"/>
    </resultMap>
    <select id="GetStock" resultMap="ResultMapStock" parameterType="map">
		select a.*,a.goo_total-IFNULL((
		select sum(b.org_number)
		from tic_order_goods b
		left join tic_order c
		on c.ord_id = b.org_order_id
		where b.org_goods_id = a.goo_id
		and (c.ord_order_status = 201 or c.ord_order_status = 301 or c.ord_order_status = 101)
		and to_days(c.ord_confirm_time) = to_days(#{ Time , jdbcType = VARCHAR} )),0) stock
		from tic_goods a
		where a.goo_deleted = 0
        <if test="catId != null">
            AND a.goo_cat_id = #{catId,jdbcType=INTEGER}
        </if>
		AND a.goo_is_on_sale = 1
	</select>

    <!--  查询单商品库存  -->
    <select id="getOneStock" resultMap="ResultMapStock" parameterType="map">
		select a.*,a.goo_total-IFNULL((
		select sum(b.org_number)
		from tic_order_goods b
		left join tic_order c on c.ord_id = b.org_order_id
		where b.org_goods_id = a.goo_id
		and (c.ord_order_status = 201 or c.ord_order_status = 301 or c.ord_order_status = 101)
		and to_days(c.ord_confirm_time) = to_days( #{ Time , jdbcType = VARCHAR} )),0) stock
		from tic_goods a
		where a.goo_cat_id = #{catId,jdbcType=INTEGER}
		and a.goo_id = #{gooId,jdbcType=INTEGER}
		AND a.goo_is_on_sale = 1
		AND a.goo_deleted = 0
	</select>
</mapper>